{"description": "This package provides some basic analysis for Mach-o files.", "tags": "intel, files, mach-o, macho", "version": "v0.1.1", "depends": null, "test_cmd": "cd tests && btest", "build_cmd": "./configure --enable-debug --zeek-dist=%(zeek_dist)s && make", "url": "https://github.com/corelight/zeek-macho", "summary": null, "script_dir": "scripts/Zeek/MACHO", "plugin_dir": null, "readme": "\n# A Zeek Mach-o File Analysis Package\n\nThis package implements:\n\n- Mach-o\n\n## TLDR!\n\nIf you have zkg and you have already run...\n\n```\nzkg autoconfig\n```\n\n... then you can install this package as so:\n\n```\nsudo zkg install zeek-macho\n```\n\nNow in any Zeek script, just load the plugin and it \"just works\":\n\n```\n@load Zeek/MACHO\n```\n\nNew events for this plugin are found in [events.bif](src/events.bif).\n\n## Building and Installing\n\nThis plugin can be built with:\n\n```\n./configure --zeek-dist=/your/zeek/src/dir\nmake\nsudo make install\n```\n\n## Using MACHO\n\nThe testing pcap file:  \n\nhttps://github.com/corelight/zeek-macho/blob/master/tests/Traces/all_executables.pcap\n\nBinaries in this pcap were pulled from:\n\nhttps://github.com/JonathanSalwan/binary-samples\n\nOnce this analyzer is installed, this plugin can be loaded with the following Zeek script:\n\n```\n@load Zeek/MACHO\n\nevent file_macho_header_raw(f: fa_file, m: Zeek::MACHOHeaderRaw)\n    {\n    print \"====\";\n    print \"MACHO HEADER RAW\";\n    print m$signature;\n    print \"====\";\n    }\n\nevent file_macho_single_binary_command(f: fa_file, m: Zeek::MACHOHeaderRaw, cmd_num: count, offset: count, c: Zeek::MACHOCommand)\n    {\n    print \"====\";\n    print \"MACHO SINGLE BINARY COMMAND\";\n    print offset;\n    print cmd_num;\n    print c$segname;\n    print \"====\";\n    }\n\nevent file_macho_universal_binary_arch(f: fa_file, m: Zeek::MACHOHeaderRaw, a: Zeek::MACHOFATArch)\n    {\n    print \"====\";\n    print \"MACHO UNIVERSAL BINARY ARCH\";\n    print f$id;\n    print a;\n    print \"====\";\n    }\n```\n\nThe output should look like this:\n\n```\n% zeek -r pcaps/all_binaries.pcap -C macho.zeek\n====\nMACHO HEADER RAW\n\\xca\\xfe\\xba\\xbe\n====\n====\nMACHO UNIVERSAL BINARY ARCH\nFdLrA12jaXM0aeUFL7\n[cpu_type=7, cpu_subtype=3, offset=4096, size=576016, align=12, reserved=<uninitialized>]\n====\n====\nMACHO UNIVERSAL BINARY ARCH\nFdLrA12jaXM0aeUFL7\n[cpu_type=18, cpu_subtype=10, offset=581632, size=663296, align=12, reserved=<uninitialized>]\n====\n====\nMACHO HEADER RAW\n\\xcf\\xfa\\xed\\xfe\n====\n====\nMACHO SINGLE BINARY COMMAND\n28\n1\n\\x19\\x00\\x00\\x00H\\x00\\x00\\x00__PAGEZE\n====\n====\nMACHO SINGLE BINARY COMMAND\n100\n2\n\\x19\\x00\\x00\\x00(\\x02\\x00\\x00__TEXT\\x00\\x00\n====\n====\nMACHO SINGLE BINARY COMMAND\n652\n3\n\\x19\\x00\\x00\\x00\\xc8\\x02\\x00\\x00__DATA\\x00\\x00\n====\n====\nMACHO SINGLE BINARY COMMAND\n1364\n4\n\\x19\\x00\\x00\\x00H\\x00\\x00\\x00__LINKED\n====\n====\nMACHO HEADER RAW\n\\xce\\xfa\\xed\\xfe\n====\n====\nMACHO SINGLE BINARY COMMAND\n24\n1\n\\x01\\x00\\x00\\x008\\x00\\x00\\x00__PAGEZE\n====\n====\nMACHO SINGLE BINARY COMMAND\n80\n2\n\\x01\\x00\\x00\\x00\\x8c\\x01\\x00\\x00__TEXT\\x00\\x00\n====\n====\nMACHO SINGLE BINARY COMMAND\n476\n3\n\\x01\\x00\\x00\\x00\\x14\\x02\\x00\\x00__DATA\\x00\\x00\n====\n====\nMACHO SINGLE BINARY COMMAND\n1008\n4\n\\x01\\x00\\x00\\x008\\x00\\x00\\x00__LINKED\n====\n====\nMACHO HEADER RAW\n\\xce\\xfa\\xed\\xfe\n====\n====\nMACHO HEADER RAW\n\\xca\\xfe\\xba\\xbe\n====\n====\nMACHO UNIVERSAL BINARY ARCH\nFcXhineqH4rVNW5n2\n[cpu_type=12, cpu_subtype=9, offset=16384, size=91792, align=14, reserved=<uninitialized>]\n====\n====\nMACHO UNIVERSAL BINARY ARCH\nFcXhineqH4rVNW5n2\n[cpu_type=12, cpu_subtype=11, offset=114688, size=91792, align=14, reserved=<uninitialized>]\n====\n====\nMACHO UNIVERSAL BINARY ARCH\nFcXhineqH4rVNW5n2\n[cpu_type=16777228, cpu_subtype=0, offset=212992, size=93248, align=14, reserved=<uninitialized>]\n====\n====\nMACHO HEADER RAW\n\\xce\\xfa\\xed\\xfe\n====\n====\nMACHO HEADER RAW\n\\xcf\\xfa\\xed\\xfe\n====\n====\nMACHO SINGLE BINARY COMMAND\n28\n1\n\\x19\\x00\\x00\\x00H\\x00\\x00\\x00__PAGEZE\n====\n====\nMACHO SINGLE BINARY COMMAND\n100\n2\n\\x19\\x00\\x00\\x00(\\x02\\x00\\x00__TEXT\\x00\\x00\n====\n====\nMACHO SINGLE BINARY COMMAND\n652\n3\n\\x19\\x00\\x00\\x00\\xe8\\x00\\x00\\x00__DATA_C\n====\n====\nMACHO SINGLE BINARY COMMAND\n884\n4\n\\x19\\x00\\x00\\x00\\x88\\x01\\x00\\x00__DATA\\x00\\x00\n====\n====\nMACHO SINGLE BINARY COMMAND\n1276\n5\n\\x19\\x00\\x00\\x00H\\x00\\x00\\x00__LINKED\n====\n====\nMACHO HEADER RAW\n\\xca\\xfe\\xba\\xbe\n====\n====\nMACHO UNIVERSAL BINARY ARCH\nFYXjlFG0LU4PmVdYg\n[cpu_type=16777223, cpu_subtype=3, offset=4096, size=26864, align=12, reserved=<uninitialized>]\n====\n====\nMACHO UNIVERSAL BINARY ARCH\nFYXjlFG0LU4PmVdYg\n[cpu_type=7, cpu_subtype=3, offset=32768, size=26320, align=12, reserved=<uninitialized>]\n====\n\n% cat files.log \n#separator \\x09\n#set_separator\t,\n#empty_field\t(empty)\n#unset_field\t-\n#path\tfiles\n#open\t2019-12-16-10-29-55\n#fields\tts\tfuid\ttx_hosts\trx_hosts\tconn_uids\tsource\tdepth\tanalyzers\tmime_type\tfilename\tduration\tlocal_orig\tis_orig\tseen_bytes\ttotal_bytes\tmissing_bytes\toverflow_bytes\ttimedout\tparent_fuid\tmd5\tsha1\tsha256\textracted\textracted_cutoff\textracted_size\n#types\ttime\tstring\tset[addr]\tset[addr]\tset[string]\tstring\tcount\tset[string]\tstring\tstring\tinterval\tbool\tbool\tcount\tcount\tcount\tcount\tbool\tstring\tstring\tstring\tstring\tstring\tbool\tcount\n1575573054.714905\tFdLrA12jaXM0aeUFL7\t127.0.0.1\t127.0.0.1\tCxtoJD1vAp3SAL6Sxa\tHTTP\t0\tMACHO\tapplication/x-mach-o-executable\t-\t0.017705\t-\tF\t1244928\t1244928\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.748160\tFa366V2TpUNaGJHQT9\t127.0.0.1\t127.0.0.1\tCylX6c1KHZ0EwM06U3\tHTTP\t0\t(empty)\t-\t-\t0.007859\t-\tF\t450568\t450568\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.771418\tFzLp3E23ljWzpUhjYb\t127.0.0.1\t127.0.0.1\tCcJKvMezJ9TNOhHL4\tHTTP\t0\tMACHO\tapplication/x-mach-o-executable\t-\t0.000020\t-\tF\t39584\t39584\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.786828\tFT0BPEFTGWsUJnKq5\t127.0.0.1\t127.0.0.1\tCjmFig4ABur1iYqH4d\tHTTP\t0\tMACHO\tapplication/x-mach-o-executable\t-\t0.000028\t-\tF\t35696\t35696\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.805742\tFpsfRh42ET7tOfLZSa\t127.0.0.1\t127.0.0.1\tCmKoMf1ltIDMiZPima\tHTTP\t0\tMACHO\tapplication/x-mach-o-executable\t-\t0.009188\t-\tF\t546768\t546768\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.831830\tFcXhineqH4rVNW5n2\t127.0.0.1\t127.0.0.1\tCMWdMs1R2GehAArRv5\tHTTP\t0\tMACHO\tapplication/x-mach-o-executable\t-\t0.006384\t-\tF\t306240\t306240\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.856230\tFi71fa4AoXLFkyBZxc\t127.0.0.1\t127.0.0.1\tC5CyRL3CKWQ7mx8yk9\tHTTP\t0\tMACHO\tapplication/x-mach-o-executable\t-\t0.000851\t-\tF\t91792\t91792\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.870413\tFf9tRIJzK5SSo0Mfe\t127.0.0.1\t127.0.0.1\tCYGjah44KvN4fUoql1\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.000027\t-\tF\t8088\t8088\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.884851\tFOYYch36HZTvrQPlTi\t127.0.0.1\t127.0.0.1\tC7b9id4JIofsroEika\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.044493\t-\tF\t2573932\t2573932\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.945714\tFPx37D1lITkX5Ihrx5\t127.0.0.1\t127.0.0.1\tCK7zsr1GdzIXU3lqKl\tHTTP\t0\t(empty)\tapplication/x-sharedlib\t-\t0.001765\t-\tF\t173604\t173604\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.960002\tFfTba01VvghPWqT3Gc\t127.0.0.1\t127.0.0.1\tC2L8yiffwefJGdZij\tHTTP\t0\t(empty)\tapplication/x-sharedlib\t-\t0.009696\t-\tF\t733535\t733535\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573054.985255\tFhtxt04pKjMXuz3xkg\t127.0.0.1\t127.0.0.1\tClIS25MBjMfsTqkD1\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.014386\t-\tF\t847400\t847400\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.014785\tFiQK8tHSTDLqHj481\t127.0.0.1\t127.0.0.1\tCLdCvP2S3XkpjeDqS\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.000978\t-\tF\t90808\t90808\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.029562\tF7ydFjDejfkK5p93g\t127.0.0.1\t127.0.0.1\tCghFyD2L9NUmUQYBBl\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.014827\t-\tF\t926576\t926576\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.059888\tF61rl1HjvAvod4IKf\t127.0.0.1\t127.0.0.1\tCYkhfL1vSZlBAcJTQc\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.013047\t-\tF\t903556\t903556\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.086529\tFrniXj4G5FBbipKAXj\t127.0.0.1\t127.0.0.1\tC2oGU9rkWOcBmCOk2\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.010830\t-\tF\t954028\t954028\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.111601\tFoa6OD353qEAod1Rtd\t127.0.0.1\t127.0.0.1\tCNoQ0f92BZesFkog3\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.010550\t-\tF\t856496\t856496\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.136312\tFlQg1C3yoYu4Ii79G1\t127.0.0.1\t127.0.0.1\tCeFLUd3ymDkRpBOnKi\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.008135\t-\tF\t693024\t693024\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.158362\tFDpoEk1h413vhqsAY7\t127.0.0.1\t127.0.0.1\tCUMhkgHpG8wY9xX3\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.008786\t-\tF\t770392\t770392\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.180801\tFfJxYq2UH8pobDAyh\t127.0.0.1\t127.0.0.1\tClSJ7p29IEYBGO0qol\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.020865\t-\tF\t1486344\t1486344\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.219834\tFJCWvz4H8NXellwgQg\t127.0.0.1\t127.0.0.1\tCJ02x93rtdCeQRwi3d\tHTTP\t0\t(empty)\tapplication/x-sharedlib\t-\t0.022064\t-\tF\t1145944\t1145944\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.258825\tFD0tNZ191kLavvTgy8\t127.0.0.1\t127.0.0.1\tCHFN3VxPRyhV2OsM6\tHTTP\t0\t(empty)\tapplication/x-sharedlib\t-\t0.023405\t-\tF\t1134116\t1134116\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.297420\tF5xbP13O6XYTMLgcma\t127.0.0.1\t127.0.0.1\tC7Ucim1qeEfGr4vDJh\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.016132\t-\tF\t851464\t851464\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.329918\tFxsJOG1mVPjddyfuSe\t127.0.0.1\t127.0.0.1\tCoZ4ij2Zq06hoZKxm3\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.016251\t-\tF\t926536\t926536\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.369187\tFsZcQB8W5LMIbZCA1\t127.0.0.1\t127.0.0.1\tCMCowK3t3rYp4bE2y2\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.011578\t-\tF\t811156\t811156\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.398939\tFZhVgl2N790Dfa2FFa\t127.0.0.1\t127.0.0.1\tCm2ITy2nZd7OUpCVJc\tHTTP\t0\t(empty)\tapplication/x-sharedlib\t-\t0.000000\t-\tF\t9552\t9552\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.415558\tFoAJTP3Sasv7vDJRW7\t127.0.0.1\t127.0.0.1\tCt9EiTTil8dMsHu2d\tHTTP\t0\t(empty)\tapplication/x-sharedlib\t-\t0.008120\t-\tF\t563936\t563936\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.441153\tFlRQhc4ipvfl75f289\t127.0.0.1\t127.0.0.1\tCwXCaW0lsfc0KQWog\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.007160\t-\tF\t401436\t401436\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.463867\tFkwXG93nBmzNl2DOyj\t127.0.0.1\t127.0.0.1\tCGjxVT25tI84tJMxD2\tHTTP\t0\t(empty)\tapplication/x-executable\t-\t0.007288\t-\tF\t436765\t436765\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.498662\tFn2NC31bzy2NH8Wt04\t127.0.0.1\t127.0.0.1\tCOU3VZ2xEBbcwE0Rqc\tHTTP\t0\tMACHO\tapplication/x-mach-o-executable\t-\t0.000022\t-\tF\t65040\t65040\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.515049\tFYXjlFG0LU4PmVdYg\t127.0.0.1\t127.0.0.1\tC3YVG53MQpUuJcj3zh\tHTTP\t0\tMACHO\tapplication/x-mach-o-executable\t-\t0.000056\t-\tF\t59088\t59088\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.533650\tF3tpQ24gwPmAINB1ri\t127.0.0.1\t127.0.0.1\tCKkHPrI1mhc45G1Dg\tHTTP\t0\tPE\tapplication/x-dosexec\t-\t0.000000\t-\tF\t6656\t6656\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.549630\tFId7Y313XTAGt3u333\t127.0.0.1\t127.0.0.1\tCfDajp1HnHz9Rn2YG8\tHTTP\t0\tPE\tapplication/x-dosexec\t-\t0.006863\t-\tF\t345088\t345088\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.572433\tFg4xin2mdkzOE1JrJk\t127.0.0.1\t127.0.0.1\tCXXe9k4pjeUbSw5K3d\tHTTP\t0\tPE\tapplication/x-dosexec\t-\t0.004190\t-\tF\t301568\t301568\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.593431\tFAoNZT3AgAf5H3hzg2\t127.0.0.1\t127.0.0.1\tCHbOJb1LjssvtbX0u3\tHTTP\t0\tPE\tapplication/x-dosexec\t-\t0.001843\t-\tF\t135197\t135197\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n1575573055.610819\tFPxiZq2WmMpcqRuJhe\t127.0.0.1\t127.0.0.1\tCCMZ6D2a85vPJAvtF2\tHTTP\t0\tPE\tapplication/x-dosexec\t-\t0.016037\t-\tF\t1160718\t1160718\t0\t0\tF\t-\t-\t-\t-\t-\t-\t-\n#close\t2019-12-16-10-29-55\n\n% cat macho.log \n#separator \\x09\n#set_separator\t,\n#empty_field\t(empty)\n#unset_field\t-\n#path\tmacho\n#open\t2019-12-16-10-29-55\n#fields\tts\tid\tsignature\tis_64bit\tlittle_endian\tis_universal_binary\tnum_binaries\tcpu_types\tcpu_subtypes\timage_offsets\timage_sizes\tfiletype\tncmds\tsizeofcmds\tflags\n#types\ttime\tstring\tstring\tbool\tbool\tbool\tcount\tvector[string]\tvector[string]\tvector[count]\tvector[count]\tstring\tcount\tcount\tstring\n1575573054.714905\tFdLrA12jaXM0aeUFL7\t0xCAFEBABE\tF\tF\tT\t2\tx86,POWERPC\t386,7400\t4096,581632\t576016,663296\t-\t-\t-\t-\n1575573054.771418\tFzLp3E23ljWzpUhjYb\t0xFEEDFACF\tT\tT\tF\t-\tx86_64\tALL\t(empty)\t(empty)\tMH_EXECUTE\t16\t2008\t0x00200085\n1575573054.786828\tFT0BPEFTGWsUJnKq5\t0xFEEDFACE\tF\tT\tF\t-\tx86\t386\t(empty)\t(empty)\tMH_EXECUTE\t16\t1528\t0x01200085\n1575573054.805742\tFpsfRh42ET7tOfLZSa\t0xFEEDFACE\tF\tT\tF\t-\tARM\tALL\t(empty)\t(empty)\tMH_EXECUTE\t15\t1560\t0x00000085\n1575573054.831830\tFcXhineqH4rVNW5n2\t0xCAFEBABE\tF\tF\tT\t3\tARM,ARM,ARM64\tV7,V7S,ALL\t16384,114688,212992\t91792,91792,93248\t-\t-\t-\t-\n1575573054.856230\tFi71fa4AoXLFkyBZxc\t0xFEEDFACE\tF\tT\tF\t-\tARM\tV7S\t(empty)\t(empty)\tMH_EXECUTE\t24\t2452\t0x00200085\n1575573055.498662\tFn2NC31bzy2NH8Wt04\t0xFEEDFACF\tT\tT\tF\t-\tx86_64\tALL\t(empty)\t(empty)\tMH_EXECUTE\t17\t1704\t0x00200085\n1575573055.515049\tFYXjlFG0LU4PmVdYg\t0xCAFEBABE\tF\tF\tT\t2\tx86_64,x86\tALL,386\t4096,32768\t26864,26320\t-\t-\t-\t-\n#close\t2019-12-16-10-29-55\n```\n\nEnjoy!\n\n## License:\n\nThis application(s) is/are covered by the Creative Commons BY-SA license."}