{"description": "A package to detect CVE-2021-42292, a Microsoft Excel priviledge exploit.", "tags": null, "version": "v0.1.0", "depends": ["zeek >=3.0.0"], "test_cmd": "cd testing && btest -c btest.cfg", "build_cmd": null, "url": "https://github.com/corelight/CVE-2021-42292", "summary": "A package to detect CVE-2021-42292, a Microsoft Excel priviledge exploit.", "script_dir": "scripts", "plugin_dir": null, "readme": "## CVE-2021-42292\n\nThis package will detect exploits of [CVE-2021-42292](https://raw.githubusercontent.com/corelight/CVE-2021-42292/master/http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42292), a Microsoft Excel local\nprivilege escalation vulnerability, and generate a notice in notice.log for it.\n\nhttps://corelight.com/blog/detecting-cve-2021-42292  \n\n#### Detection Method:\n\nThis package detects the vulnerability when the triggering Excel spreadsheet downloads a second spreadsheet.\nThe second spreadsheet is executed with elevated privileges.  We can detect Microsoft Excel downloading\na Microsoft Excel file with this script.  In our testing on some live networks we monitor,\nthis combination was extremely rare and we have not seen any false positives so far.\n\n#### Usage:\n\n```\n$ zeek -Cr excelsploit_1.pcap packages\n\n$ cat notice.log\n#separator \\x09\n#set_separator  ,\n#empty_field    (empty)\n#unset_field    -\n#path   notice\n#open   2021-11-10-10-56-50\n#fields ts      uid     id.orig_h       id.orig_p       id.resp_h       id.resp_p       fuid    file_mime_type  file_desc       proto   note    msg     sub     src     dst     p       n       peer_descr      actions email_dest      suppress_for    remote_location.country_code    remote_location.region  remote_location.city    remote_location.latitude        remote_location.longitude\n#types  time    string  addr    port    addr    port    string  string  string  enum    enum    string  string  addr    addr    port    count   string  set[enum]       set[string]     interval        string  string  string  double  double\n1636433584.277654       CeV1DA2EM1pRTfgWkc      127.0.0.1       51543   127.0.0.1       80      -       -       -       tcp     CVE_2021_42292::CVE_2021_42292  127.0.0.1 may be compromised by CVE-2021-42292, MS Office Excel download using Office from 127.0.0.1 detected. See sub field for additional triage information  host='127.0.0.1', method='HEAD', user_agent='Microsoft Office Excel 2014', CONTENT-TYPE='application/vnd.ms-excel', uri='/replica.xls'      127.0.0.1       127.0.0.1       80      -       -       Notice::ACTION_LOG      (empty) 3600.000000     -       -       -       -       -\n1636433584.311236       CgKWSM1bhhl7K8B6n8      127.0.0.1       51545   127.0.0.1       80      -       -       -       tcp     CVE_2021_42292::CVE_2021_42292  127.0.0.1 may be compromised by CVE-2021-42292, MS Office Excel download using Office from 127.0.0.1 detected. See sub field for additional triage information  host='127.0.0.1', method='GET', user_agent='Mozilla/4.0 (compatible; ms-office; MSOffice 16)', CONTENT-TYPE='application/vnd.ms-excel', uri='/replica.xls'  127.0.0.1       127.0.0.1       80      -       -       Notice::ACTION_LOG      (empty) 3600.000000     -       -       -       -       -\n#close  2021-11-10-10-56-50\n```\n\nSuricata rules are also provided that mirror the detection methodology of the\nZeek package.\n\n#### Links:\n* Associated blog including walk through of code elements:  \n    * https://corelight.com/blog/detecting-cve-2021-42292   \n* MIME Types:\n    * https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types\n* Excel User Agents:\n    * https://developers.whatismybrowser.com/useragents/explore/software_name/excel/\n"}