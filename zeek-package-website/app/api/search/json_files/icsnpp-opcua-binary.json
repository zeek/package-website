{"description": "OPC Unified Architecture Binary plugin for parsing and logging of the OPC UA Binary protocol - CISA ICSNPP", "tags": "opcua, opcua_binary, opc, ICS, CISA, INL, ICSNPP, icsnpp, zeek plugin, log writer, protocol analyzer", "version": "main", "depends": null, "test_cmd": "cd tests && btest -c btest.cfg", "build_cmd": "./configure && make", "url": "https://github.com/cisagov/icsnpp-opcua-binary", "summary": null, "script_dir": "build/scripts/icsnpp/opcua-binary", "plugin_dir": null, "readme": "# ICSNPP-OPCUA_Binary\n\nIndustrial Control Systems Network Protocol Parsers (ICSNPP) - OPC Unified Architecture Binary (OPC UA Binary).\n\n## Overview\n\nICSNPP-OPCUA_Binary is a Zeek plugin for parsing and logging fields within the OPC Unified Architecture Binary protocol.\n\nThe OPC Unified Architecture defines three data encodings: - OPC UA Binary, OPC UA XML, and OPC UA JSON. This plugin targets the OPC UA Binary encoding.\n\nSpecification details can be found on the OPC Foundation Org website located [here](https://opcfoundation.org/developer-tools/specifications-unified-architecture)\n\nThe initial implementation of the parser focuses on logging the message type and the service request and response headers, along with any diagnostic and error information that may be present. The service numeric identifier and associated identifier string are also logged; however, the details of the service being called have been stubbed out for most of the services. Future development on the parser will focus on filling out this information.\n\nThis parser produces a variety of different log files. An overview of these log files can be found in the Logging Capabilities section below.\n\n## Installation\n\n### Package Manager\n\nThis script is available as a package for [Zeek Package Manger](https://docs.zeek.org/projects/package-manager/en/stable/index.html)\n\n```bash\nzkg refresh\nzkg install icsnpp-opcua-binary\n```\n\nIf this package is installed from ZKG, it will be added to the available plugins. This can be tested by running `zeek -N`. If installed correctly you will see `ICSNPP::OPCUA_Binary`.\n\nIf ZKG is configured to load packages (see @load packages in quickstart guide), this plugin and these scripts will automatically be loaded and ready to go.\n[ZKG Quickstart Guide](https://docs.zeek.org/projects/package-manager/en/stable/quickstart.html)\n\nIf users are not using site/local.zeek or another site installation of Zeek and want to run this package on a packet capture, they can add `icsnpp/opcua-binary` to the command to run this plugin's scripts on the packet capture:\n\n```bash\ngit clone https://github.com/cisagov/icsnpp-opcua-binary.git\nzeek -Cr <sample packet capture> icsnpp/opcua-binary\n```\n\n### Manual Install\n\nTo install this package manually, clone this repository and run the configure and make commands as shown below.\n\n```bash\ngit clone https://github.com/cisagov/icsnpp-opcua-binary.git\ncd icsnpp-opcua-binary/\n./configure\nmake\n```\n\nIf these commands succeed, users will end up with a newly created build directory that contains all the files needed to run/test this plugin. The easiest way to test the parser is to point the ZEEK_PLUGIN_PATH environment variable to this build directory.\n\n```bash\nexport ZEEK_PLUGIN_PATH=$PWD/build/\nzeek -N # Ensure everything compiled correctly and you are able to see ICSNPP::OPCUA_Binary\n```\n\nOnce users have tested the functionality locally and it appears to have compiled correctly, they can install it system-wide:\n```bash\nsudo make install\nunset ZEEK_PLUGIN_PATH\nzeek -N # Ensure everything installed correctly and you are able to see ICSNPP::OPCUA_Binary\n```\n\nTo run this plugin in a site deployment, users will need to add the line `@load icsnpp/opcua-binary` to the `site/local.zeek` file to load this plugin's scripts.\n\nIf users are not using site/local.zeek or another site installation of Zeek and want to run this package on a packet capture, they can add `icsnpp/opcua-binary` to the command to run this plugin's scripts on the packet capture:\n\n```bash\nzeek -Cr <sample packet capture> icsnpp/opcua-binary\n```\n\nIf users want to deploy this on an already existing Zeek implementation and don't want to build the plugin on the machine, they can extract the ICSNPP_OPCUA_Binary.tgz file to the directory of the established ZEEK_PLUGIN_PATH (default is `${ZEEK_INSTALLATION_DIR}/lib/zeek/plugins/`).\n\n```bash\ntar xvzf build/ICSNPP_OPCUA_Binary.tgz -C $ZEEK_PLUGIN_PATH \n```\n\n## Logging Capabilities\n\n#### Primary Log (opcua-binary.log)\n\nThis log captures the OPCUA message header, message type (HEL, ACK, MSG), service request/response headers, along with the service identifier, and logs it to **opcua-binary.log**. \n\n* See the ```OPCUA_Binary::Info: record``` in file [types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/types.zeek) for a list of the fields logged.\n\n### OPCUA Type Logging\n\n#### Diagnostic Information Detail (opcua-binary-diag-info-detail.log)\n\nThis log captures the details of any diagnostic information present in the service response header and logs it to **opcua-binary-diag-info-detail.log**.\n\n* See the ```OPCUA_Binary::DiagnosticInfoDetail: record``` in file [statuscode-diagnostic-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/statuscode-diagnostic-types.zeek) for a list of the fields logged.\n* See the ```type OpcUA_DiagInfo = record``` in file [opcua_binary-types.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/types/opcua_binary-types.pac) for details on the diagnostic information structure.\n* See [opcua_binary-req_res_header_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/req-res-header/opcua_binary-req_res_header_analyzer.pac) for details on processing this information.\n\n#### Status Code Detail (opcua-binary-status-code-detail.log)\n\nThis log captures the details of any status codes in the service response header and logs it to **opcua-binary-status-code-detail.log**. \n\n* See the ```OPCUA_Binary::StatusCodeDetail: record``` in file [statuscode-diagnostics-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/statuscode-diagnostic-types.zeek) for a list of the fields logged.\n* See [status_codes.h](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/headers/status_codes.h) for a list of status codes and their associated information. \n* See [opcua_binary-req_res_header_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/req-res-header/opcua_binary-req_res_header_analyzer.pac) for details on processing this information.\n\n#### Filter Detail (opcua-binary-aggregate-filter.log, opcua-binary-data-change-filter.log, opcua-binary-event-filter.log, opcua-binary-event-filter-attribute-operand.log, opcua-binary-event-filter-attribute-operand-browse-paths.log, opcua-binary-event-filter-where-clause.log, opcua-binary-event-filter-where-clause-elements.log, opcua-binary-event-filter-element-operand.log, opcua-binary-event-filter-literal-operand.log, opcua-binary-event-filter-select-clause.log, opcua-binary-event-filter-simple-attribute-operand.log, opcua-binary-event-filter-simple-attribute-operand-browse-paths.log)\n\nThis log captures the details associated with filter objects.\n\n* See [filter-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/filter-types.zeek) for a list of the fields logged.\n* See [opcua_binary-filter_types.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/types/filters/opcua_binary-filter_types.pac), [opcua_binary-filter_types_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/types/filters/opcua_binary-filter_types_analyzer.pac), and [opcua_binary-filter_types_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/types/filters/opcua_binary-filter_debug.pac) for details on parsing, processing, and logging this service.\n\n#### Variant Detail (opcua-binary-variant-array-dims.log, opcua-binary-variant-data.log, opcua-binary-variant-data-value.log, opcua-binary-variant-extension-object.log, opcua-binary-variant-metadata.log)\n\nThis log captures the details associated with variant objects.\n\n* See [variant-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/variant-types.zeek) for a list of the fields logged.\n* See [opcua_binary-variant_types.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/types/variants/opcua_binary-variant_types.pac), [opcua_binary-variant_types_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/types/variants/opcua_binary-variant_types_analyzer.pac), and [opcua_binary-variant_types_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/types/variants/opcua_binary-variant_types_debug.pac) for details on parsing, processing, and logging this service.\n\n### OPCUA Services Logging\n\n#### Activate Session Service (opcua-binary-activate-session.log, opcua-binary-activate-session-client-software-cert.log, opcua-binary-activate-session-locale-id.log)\n\nThis log captures the details associated with calls to the Activate Session Service.\n\n* See [activate-session-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/activate-session-types.zeek) for a list of the fields logged.\n* See [opcua_binary-activate_session.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/activate-session/opcua_binary-activate_session.pac), [opcua_binary-activate_session_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/activate-session/opcua_binary-activate_session_analyzer.pac), and [opcua_binary-activate_session_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/activate-session/opcua_binary-activate_session_debug.pac) for details on parsing, processing, and logging this service.\n\n#### Browse Service (opcua-binary-browse.log, opcua-binary-browse-description.log, opcua-binary-browse-request-continuation-point.log, opcua-binary-browse-result.log, opcua-binary-browse-response-references.log)\n\nThis log captures the details associated with calls to the Browse Service.\n\n* See [browse-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/browse-types.zeek) for a list of the fields logged.\n* See [opcua_binary-browse.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/browse/opcua_binary-browse.pac), [opcua_binary-browse_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/browse/opcua_binary-browse_analyzer.pac), and [opcua_binary-browse_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/browse/opcua_binary-browse_debug.pac) for details on parsing, processing, and logging this service.\n\n#### Close Session Service (opcua-binary-close-session.log)\n\nThis log captures the details associated with calls to the Close Session Service.\n\n* See [close-session-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/create-session-types.zeek) for a list of the fields logged.\n* See [opcua_binary-close-session.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/close-session/opcua_binary-close-session.pac), [opcua_binary-close-session.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/close-session/opcua_binary-close-session_analyzer.pac), and [opcua_binary-close-session_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/close-session/opcua_binary-close-session_debug.pac) for details on parsing, processing, and logging this service.\n#### Create Monitored Items Service (opcua-binary-create-monitored-items.log, opcua-binary-create-monitored-items-create-item.log)\n\nThis log captures the details associated with calls to the Create Session Service.\n\n* See [create-monitored-items-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/create_monitored_items-types.zeek) for a list of the fields logged.\n* See [opcua_binary-create_monitored_items.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create_monitored_items/opcua_binary-create_monitored_items.pac), [opcua_binary-create_monitored_items_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create_monitored_items/opcua_binary-create_monitored_items_analyzer.pac), and [opcua_binary-create_monitored_items_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create_monitored_items/opcua_binary-create_monitored_items_debug.pac) for details on parsing, processing, and logging this service.\n\n#### Create Session Service (opcua-binary-create-session.log, opcua-binary-create-session-discovery.log, opcua-binary-create-session-endpoints.log, opcua-binary-create-session-user-token.log)\n\nThis log captures the details associated with calls to the Create Session Service.\n\n* See [create-session-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/create-session-types.zeek) for a list of the fields logged.\n* See [opcua_binary-create_session.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create-session/opcua_binary-create_session.pac), [opcua_binary-create_session_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create-session/opcua_binary-create_session_analyzer.pac), and [opcua_binary-create_session_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create-session/opcua_binary-create_session_debug.pac) for details on parsing, processing, and logging this service.\n\n#### Create Subscription Service (opcua-binary-create-subscription.log)\n\nThis log captures the details associated with calls to the Create Subscription Service.\n\n* See [create_subscription-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/create-subscription-types.zeek) for a list of the fields logged.\n* See [opcua_binary-create_subscription.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create-subscription/opcua_binary-create_subscription.pac), [opcua_binary-create_subscription_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create-subscription/opcua_binary-create_subscription_analyzer.pac), and [opcua_binary-create_subscription_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/create-subscription/opcua_binary-create_subscription_debug.pac) for details on parsing, processing, and logging this service.\n\n#### Get Endpoints Service (opcua-binary-get-endpoints.log, opcua-binary-get-endpoints-description.log, opcua-binary-get-endpoints-discovery.log, opcua-binary-get-endpoints-locale_id.log, opcua-binary-get-endpoints-profile_uri.log, opcua-binary-get-endpoints-user_token.log)\n\nThis log captures the details associated with calls to the Get Endpoints Service.\n\n* See [get-endpoints-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/get-endpoints-types.zeek) for a list of the fields logged.\n* See [opcua_binary-get_endpoints.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/get-endpoints/opcua_binary-get_endpoints.pac), [opcua_binary-get_endpoints_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/get-endpoints/opcua_binary-get_endpoints_analyzer.pac), and [opcua_binary-get_endpoints_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/get-endpoints/opcua_binary-get_endpoints_debug.pac) for details on parsing, processing, and logging this service.\n\n#### Read Subscription Service (opcua-binary-read.log, opcua-binary-read-nodes-to-read.log, opcua-binary-read-results.log)\n\nThis log captures the details associated with calls to the Read Subscription Service.\n\n* See [read-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/read-types.zeek) for a list of the fields logged.\n* See [opcua_binary-read.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/read/opcua_binary-read.pac), [opcua_binary-read_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/read/opcua_binary-read_analyzer.pac), and [opcua_binary-read_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/read/opcua_binary-read_debug.pac) for details on parsing, processing, and logging this service.\n\n#### Open Secure Channel Service (opcua-binary-opensecure-channel.log)\n\nThis log captures the details associated with calls to the Open Secure Channel Service.\n\n* See the ```OPCUA_Binary::OpenSecureChannel: record``` in file [secure-channel-types.zeek](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/scripts/secure-channel-types.zeek) for a list of the fields logged.\n* See [opcua_binary-secure_channel.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/secure-channel/opcua_binary-secure_channel.pac), [opcua_binary-secure_channel_analyzer.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/secure-channel/opcua_binary-secure_channel.pac), and [opcua_binary-secure_channel_debug.pac](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/src/services/secure-channel/opcua_binary-secure_channel_debug.pac) for details on parsing, processing, and logging this service.\n\n## Developer's Guide\n\nFor development and implementation details, see the [developer_guide](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/developer_guide.md)\n\n## ICSNPP Packages\n\nAll ICSNPP Packages:\n* [ICSNPP](https://github.com/cisagov/icsnpp)\n\nFull ICS Protocol Parsers:\n* [BACnet](https://github.com/cisagov/icsnpp-bacnet)\n    * Full Zeek protocol parser for BACnet (Building Control and Automation)\n* [BSAP](https://github.com/cisagov/icsnpp-bsap)\n    * Full Zeek protocol parser for BSAP (Bristol Standard Asynchronous Protocol) over IP\n    * Full Zeek protocol parser for BSAP Serial comm converted using serial tap device\n* [Ethercat](https://github.com/cisagov/icsnpp-ethercat)\n    * Full Zeek protocol parser for Ethercat\n* [Ethernet/IP and CIP](https://github.com/cisagov/icsnpp-enip)\n    * Full Zeek protocol parser for Ethernet/IP and CIP\n* [Genisys](https://github.com/cisagov/icsnpp-genisys)\n    * Full Zeek protocol parser for Genisys\n* [OPCUA-Binary](https://github.com/cisagov/icsnpp-opcua-binary)\n    * Full Zeek protocol parser for OPC UA (OPC Unified Architecture) - Binary\n* [S7Comm](https://github.com/cisagov/icsnpp-s7comm)\n    * Full Zeek protocol parser for S7comm, S7comm-plus, and COTP\n* [Synchrophasor](https://github.com/cisagov/icsnpp-synchrophasor)\n    * Full Zeek protocol parser for Synchrophasor Data Transfer for Power Systems (C37.118)\n\nUpdates to Zeek ICS Protocol Parsers:\n* [DNP3](https://github.com/cisagov/icsnpp-dnp3)\n    * DNP3 Zeek script extending logging capabilities of Zeek's default DNP3 protocol parser\n* [Modbus](https://github.com/cisagov/icsnpp-modbus)\n    * Modbus Zeek script extending logging capabilities of Zeek's default Modbus protocol parser\n\n### License\n\nCopyright 2023 Battelle Energy Alliance, LLC. Released under the terms of the 3-Clause BSD License (see [`LICENSE.txt`](https://raw.githubusercontent.com/cisagov/icsnpp-opcua-binary/master/./LICENSE.txt)).\n"}